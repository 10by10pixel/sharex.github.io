<!DOCTYPE html>
<html>
<head>
    <title>ShareX - Downloads</title>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="/favicon.ico">

    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
        }

        th, td {
            padding: 5px;
        }

        tr:nth-child(even) {
            background: #EEE;
        }
    </style>
</head>
<body>
    <table id="ReleasesTable">
        <tr>
            <th>Release name</th>
            <th>Download count</th>
            <th>Release date</th>
            <th>Active days</th>
        </tr>
    </table>

    <script src="../js/jquery.min.js"></script>
    <script src="../js/moment.min.js"></script>
    <script>
        $(document).ready(function () {
            var hashIndex = window.location.hash.indexOf("#");
            var repo = "";
            if (hashIndex !== -1) {
                repo = window.location.hash.substring(hashIndex + 1);
            }
            if (!repo)
            {
                repo = "ShareX/ShareX";
            }
            GetReleases(repo);
        });

        function GetReleases(repo) {
            $.getJSON("https://api.github.com/repos/" + repo + "/releases").done(function (json) {
                for (var i = 0; i < json.length; i++) {
                    var release = json[i];
                    var asset = release.assets[0];
                    var downloadCount = 0;
                    for (var i2 = 0; i2 < release.assets.length; i2++) {
                        downloadCount += release.assets[i2].download_count;
                    }
                    var activeDays;
                    if (i === 0) {
                        activeDays = moment().diff(moment(asset.updated_at), "days", true);
                    }
                    else {
                        activeDays = moment(json[i - 1].assets[0].updated_at).diff(moment(asset.updated_at), "days", true);
                    }
                    $('#ReleasesTable').find('tbody')
                        .append($('<tr>')
                            .append($('<td>')
                                .append($('<a>')
                                    .attr('href', release.html_url)
                                    .text(release.name)
                                )
                            )
                            .append($('<td>')
                                .text(downloadCount.toLocaleString())
                            )
                            .append($('<td>')
                                .text(moment(asset.updated_at).format("YYYY/MM/DD HH:mm"))
                            )
                            .append($('<td>')
                                .text(activeDays.toFixed(1))
                            )
                        );
                }
            });
        }
    </script>
</body>
</html>